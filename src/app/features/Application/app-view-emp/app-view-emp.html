<!-- app-view-emp.html -->

<div class="container">
    <div class="header-section">
        <div class="title-container">
            <h1>Application Inbox</h1>
            <p>Manage and review all your job applications in one place</p>
        </div>
        <div class="action-buttons">
            <button class="btn btn-secondary" (click)="refreshApplications()">Refresh</button>
            <button class="btn btn-primary">Post New Job</button>
        </div>
    </div>

    <div class="stats-section">
        <div class="stat-card">
            <h3>{{statistics().total}}</h3>
            <p>Total Applications</p>
        </div>
        <div class="stat-card">
            <h3>{{statistics().new}}</h3>
            <p>New Applications</p>
        </div>
        <div class="stat-card">
            <h3>{{statistics().thisMonth}}</h3>
            <p>This Month</p>
        </div>
        <div class="stat-card">
            <h3>{{statistics().interviews}}</h3>
            <p>Interviews Pending</p>
        </div>
    </div>

    <div class="filter-section">
        <div class="search-container">
            <input type="text" placeholder="Search by name, job, or position" (input)="onSearchInput($event)" [value]="searchTerm()" />
        </div>

        <div class="clear-filter">
            <button class="btn btn-link" (click)="clearFilters()">Clear Filters</button>
        </div>
    </div>

    <div class="status-filter-section">
        <button class="status-btn" [class.active]="isStatusActive('all')" (click)="onStatusFilterClick('all')">All Status</button>
        <button class="status-btn" [class.active]="isStatusActive(ApplicationStatus.Pending)" (click)="onStatusFilterClick(ApplicationStatus.Pending)">New</button>
        <button class="status-btn" [class.active]="isStatusActive(ApplicationStatus.UnderReview)" (click)="onStatusFilterClick(ApplicationStatus.UnderReview)">Under Review</button>
        <button class="status-btn" [class.active]="isStatusActive(ApplicationStatus.Interviewed)" (click)="onStatusFilterClick(ApplicationStatus.Interviewed)">Interview</button>
        <button class="status-btn" [class.active]="isStatusActive(ApplicationStatus.Accepted)" (click)="onStatusFilterClick(ApplicationStatus.Accepted)">Hired</button>
        <button class="status-btn" [class.active]="isStatusActive(ApplicationStatus.Rejected)" (click)="onStatusFilterClick(ApplicationStatus.Rejected)">Rejected</button>
    </div>

    <div class="applications-section">
        <div *ngIf="isLoading()" class="loading">Loading applications...</div>

        <div *ngIf="!isLoading()" class="results-container">
            <div class="results-info">
                <span>{{filteredApplicationsList().length}} Application{{filteredApplicationsList().length !== 1 ? 's' : ''}}
                    <span *ngIf="searchTerm()"> matching "{{searchTerm()}}"</span>
                </span>
                <span>Showing {{filteredApplicationsList().length}} of {{originalApplicationsList().length}} total applications</span>
            </div>

            <div *ngIf="filteredApplicationsList().length === 0" class="no-results">
                <h3>No applications found</h3>
                <p *ngIf="searchTerm() || selectedStatus() !== 'all' || selectedJobTitle()">Try adjusting your search criteria or filters.</p>
                <p *ngIf="!searchTerm() && selectedStatus() === 'all' && !selectedJobTitle()">No applications have been received yet.</p>
                <button class="btn btn-link" (click)="clearFilters()">Clear All Filters</button>
            </div>

            <div *ngIf="filteredApplicationsList().length > 0" class="application-list">
                <div *ngFor="let app of filteredApplicationsList(); trackBy: trackByApplicationId" class="application-card">
                    <div class="card-left">
                        <div class="initials" [ngClass]="getInitialsClass(app.applicantName)">
                            {{getInitials(app.applicantName)}}
                        </div>
                        <div class="applicant-info">
                            <h3>{{app.applicantName}}</h3>
                            <p>Applied for {{app.jobTitle}}</p>
                            <p>{{app.currentPosition}}</p>
                            <p>{{app.experience}}</p>
                            <p>{{app.appliedDate | date:'short'}}</p>
                        </div>
                    </div>
                    <div class="card-right">
                        <span class="status" [ngClass]="getStatusClass(app.statusDisplay)">
                            {{app.statusDisplay}}
                        </span>
                        <div class="action-buttons">
                            <button class="btn btn-outline" (click)="viewProfile(app.id)">View Profile</button>
                            <button class="btn btn-primary" (click)="scheduleInterview(app.id)" *ngIf="app.status !== ApplicationStatus.Interviewed && app.status !== ApplicationStatus.Accepted && app.status !== ApplicationStatus.Rejected">Interview</button>
                            <button class="btn btn-danger" (click)="rejectApplication(app.id)" *ngIf="app.status !== ApplicationStatus.Rejected && app.status !== ApplicationStatus.Accepted">Reject</button>
                            <a class="btn btn-outline" [href]="app.resumeUrl" target="_blank" *ngIf="app.resumeUrl">Download CV</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>