<div>
    <div class="nav">
        <a routerLink="/empDashboard"><i class="bi bi-arrow-left me-3 fs-3"></i> </a>
        <h5 class="mt-2">Back to Dashboard</h5>
    </div>
    <div class="header-section">
        <div class="title-container">
            <div class="d-flex">
                <div class="icon">
                    <i class="bi bi-buildings"></i>
                </div>
                <div>
                    <h1>Application Inbox</h1>
                    <p>Manage and review all your job applications in one place</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">

        <div class="filter-section">
            <div class="search-container">
                <input type="text" 
                    class="form-control"
                    placeholder="Search by job title..."
                    (input)="onSearchInput($event)" 
                    [value]="searchTerm()" />
            </div>

            <div class="clear-filter">
                <button class="clear-filter-btn" 
                        (click)="clearFilters()" 
                        [disabled]="!hasActiveFilters()">
                    <i class="bi bi-x-lg me-2"></i> Clear Filters
                </button>
            </div>
        </div>

        <div class="status-filter-section">
            <button class="status-btn" 
                    [class.active]="isStatusActive('')" 
                    (click)="onStatusFilterClick('')">
                All Status
            </button>
            <button class="status-btn" 
                    [class.active]="isStatusActive('Pending')" 
                    (click)="onStatusFilterClick('Pending')">
                New
            </button>
            <button class="status-btn" 
                    [class.active]="isStatusActive('UnderReview')" 
                    (click)="onStatusFilterClick('UnderReview')">
                Under Review
            </button>
            <button class="status-btn" 
                    [class.active]="isStatusActive('Interviewed')" 
                    (click)="onStatusFilterClick('Interviewed')">
                Interview
            </button>
            <button class="status-btn" 
                    [class.active]="isStatusActive('Accepted')" 
                    (click)="onStatusFilterClick('Accepted')">
                Hired
            </button>
            <button class="status-btn" 
                    [class.active]="isStatusActive('Rejected')" 
                    (click)="onStatusFilterClick('Rejected')">
                Rejected
            </button>
        </div>

        <div class="applications-section my-3">
            <div *ngIf="isLoading()" class="loading">Loading applications...</div>

            <div *ngIf="!isLoading()" class="results-container">
                <div class="results-info">
                    <h5>{{applicationsList().length}} Application{{applicationsList().length !== 1 ? 's' : ''}} found</h5>
                </div>

                <div *ngIf="applicationsList().length === 0" class="no-results">
                    <h3>No applications found</h3>
                    <p *ngIf="hasActiveFilters()">Try adjusting your search criteria or filters.</p>
                    <p *ngIf="!hasActiveFilters()">No applications have been received yet.</p>
                    <button class="clear-all-filters-btn" 
                            (click)="clearFilters()" 
                            *ngIf="hasActiveFilters()">
                        <i class="bi bi-x-lg me-2"></i> Clear Filters
                    </button>
                </div>

                <div *ngIf="applicationsList().length > 0" class="application-list">
                    <div *ngFor="let app of applicationsList(); trackBy: trackByApplicationId" 
                        class="application-card" 
                        [ngClass]="getCardClass(app.status)">
                        <div class="card-left">
                            <div class="initials" [ngClass]="getInitialsClass(app.applicantName)">
                                {{getInitials(app.applicantName)}}
                            </div>
                            <div class="applicant-info">
                                <h3>{{app.applicantName}}</h3>
                                <div class="d-flex">
                                    <span class="text-muted me-1">Applied for</span> 
                                    <h6 style="padding-top: 2px;">{{app.jobTitle}}</h6>
                                </div>
                                <div class="d-flex mt-2">
                                    <i class="bi bi-calendar-check me-2 mt-1"></i><p class="me-4">{{app.appliedDate}}</p>
                                    <p> {{app.experience}}</p>
                                </div>

                                <div class="d-flex mt-2">
                                    
                                    <!-- Resume download link - always available -->
                                    <a class="open-cv-btn" 
                                        [href]="app.resumeUrl" 
                                        target="_blank" 
                                        *ngIf="app.resumeUrl">
                                       <i class="bi bi-box-arrow-up-right me-2"></i> Open CV
                                    </a>

                                    <!-- View Application -->
                                    <button class="view-profile-btn" [routerLink]="['/appView',app.id]">
                                        <i class="bi bi-eye me-2"></i> View Application Details
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-right">

                            <span class="status" [ngClass]="getStatusClass(app.statusDisplay)">
                                {{app.statusDisplay}}
                            </span>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>