<div class="container mt-4">
  <h3>Documents</h3>
  <form #form="ngForm" (ngSubmit)="saveAndNext(form)" ngForm>
    
    <!-- File Upload Section -->
    <div class="mb-4">
      <label class="form-label">Upload Resume *</label>
      
      <!-- Drag & Drop Area -->
      <div 
        class="file-upload-area border rounded p-4 text-center"
        [class.border-primary]="!fileError && !selectedFile"
        [class.border-success]="selectedFile && !fileError"
        [class.border-danger]="fileError"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)">
        
        <!-- File Input -->
        <input 
          type="file" 
          class="form-control d-none" 
          id="fileInput"
          (change)="onFileSelected($event)"
          accept=".pdf,.doc,.docx"
          required
          #fileInputRef>
        
        <div *ngIf="!selectedFile">
          <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
          <p class="mb-2">
            <button 
              type="button" 
              class="btn btn-outline-primary"
              (click)="fileInputRef.click()">
              <i class="fas fa-folder-open me-2"></i>
              Choose File
            </button>
          </p>
          <p class="text-muted mb-0">or drag and drop your resume here</p>
        </div>
        
        <!-- Selected File Display -->
        <div *ngIf="selectedFile && !fileError" class="selected-file-info">
          <i [class]="getFileTypeIcon(selectedFile)" style="font-size: 2rem;"></i>
          <div class="mt-2">
            <strong>{{ selectedFile.name }}</strong>
            <br>
            <small class="text-muted">{{ formatFileSize(selectedFile.size) }}</small>
          </div>
          <div class="mt-2">
            <button 
              type="button" 
              class="btn btn-outline-secondary btn-sm me-2"
              (click)="fileInputRef.click()">
              <i class="fas fa-edit me-1"></i>
              Change File
            </button>
            <button 
              type="button" 
              class="btn btn-outline-danger btn-sm"
              (click)="removeFile()">
              <i class="fas fa-trash me-1"></i>
              Remove
            </button>
          </div>
        </div>
      </div>
      
      <!-- File Requirements -->
      <div class="mt-2">
        <small class="text-muted">
          <i class="fas fa-info-circle me-1"></i>
          Accepted formats: PDF, DOC, DOCX | Maximum size: 5MB
        </small>
      </div>
      
      <!-- File Error Messages -->
      <div *ngIf="fileError" class="alert alert-danger mt-2">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <small>{{ fileError }}</small>
      </div>
      
      <!-- Success Message -->
      <div *ngIf="selectedFile && !fileError" class="alert alert-success mt-2">
        <i class="fas fa-check-circle me-2"></i>
        <small>✓ Resume uploaded successfully: {{ selectedFile.name }}</small>
      </div>
    </div>
    
    <!-- Cover Letter Section -->
    <div class="mb-4">
      <label class="form-label">Cover Letter (Optional)</label>
      <textarea 
        name="coverLetter" 
        [(ngModel)]="coverLetter" 
        (input)="onCoverLetterChange()"
        class="form-control" 
        rows="6"
        maxlength="2000"
        placeholder="Write your cover letter here... 

Tip: A good cover letter should explain:
• Why you're interested in this position
• What makes you a great fit for the role  
• How your experience aligns with the job requirements
• Your enthusiasm for joining the company"
        [class.is-invalid]="coverLetterError"
        [class.is-valid]="coverLetter && coverLetter.trim().length >= 50 && !coverLetterError"></textarea>
      
      <!-- Character Counter -->
      <div class="d-flex justify-content-between mt-1">
        <small class="text-muted">
          <span *ngIf="coverLetter && coverLetter.trim()">
            {{ coverLetter.trim().split(' ').length }} words, 
          </span>
          {{ coverLetter.length }}/2000 characters
        </small>
        <small *ngIf="coverLetter && coverLetter.trim().length >= 50" class="text-success">
          <i class="fas fa-check me-1"></i>Good length
        </small>
      </div>
      
      <!-- Cover Letter Error -->
      <div *ngIf="coverLetterError" class="invalid-feedback d-block">
        <small>{{ coverLetterError }}</small>
      </div>
      
      <!-- Cover Letter Guidelines -->
      <div class="mt-2">
        <small class="text-muted">
          <i class="fas fa-lightbulb me-1"></i>
          Optional but recommended. A well-written cover letter can significantly improve your chances.
        </small>
      </div>
    </div>

    <!-- Progress Indicator -->
    <div class="alert alert-light border">
      <div class="d-flex align-items-center">
        <div class="me-3">
          <i class="fas fa-list-check text-primary"></i>
        </div>
        <div class="flex-grow-1">
          <strong>Progress Check:</strong>
          <div class="mt-1">
            <span class="badge me-2" [class]="selectedFile ? 'bg-success' : 'bg-secondary'">
              <i class="fas" [class]="selectedFile ? 'fa-check' : 'fa-times'"></i>
              Resume Upload
            </span>
            <span class="badge" [class]="coverLetter && coverLetter.trim() ? 'bg-success' : 'bg-light text-dark'">
              <i class="fas" [class]="coverLetter && coverLetter.trim() ? 'fa-check' : 'fa-minus'"></i>
              Cover Letter
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-between mt-4">
      <button type="button" (click)="goToPrevious()" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>
        Previous: Personal Info
      </button>
      <button 
        type="submit" 
        class="btn btn-primary" 
        [disabled]="!selectedFile || fileError || coverLetterError">
        <i class="fas fa-arrow-right me-2"></i>
        Next: Additional Questions
        <span *ngIf="!selectedFile" class="ms-2">
          <i class="fas fa-exclamation-triangle text-warning"></i>
        </span>
      </button>
    </div>
  </form>
</div>

<style>
.file-upload-area {
  transition: all 0.3s ease;
  min-height: 150px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  cursor: pointer;
}

.file-upload-area:hover {
  background-color: #f8f9fa;
}

.file-upload-area.border-primary:hover {
  border-color: #0d6efd !important;
  background-color: rgba(13, 110, 253, 0.05);
}

.selected-file-info {
  padding: 1rem;
}

.badge {
  font-size: 0.75em;
}
</style>