<!-- Job Board Admin Dashboard -->
<mat-card class="analytics-dashboard-card">
  <mat-card-header>
    <mat-card-title style="color: aliceblue;" >Admin Dashboard</mat-card-title>
    <mat-card-subtitle>Manage users and jobs across the platform</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading dashboard data...</p>
    </div>

    <div *ngIf="!isLoading">
      <!-- Performance Section -->
      <div class="performance-section">
        <div class="variant-tabs">
          <button mat-button class="active">Platform Statistics</button>
        </div>
        <div class="performance-cards-container">
          <!-- Total Jobs Card -->
          <mat-card class="performance-card">
            <mat-card-content>
              <div class="performance-icon-wrapper">
                <mat-icon class="card-icon">work</mat-icon>
              </div>
              <h4>Total Jobs</h4>
              <p class="value">{{ formatNumber(stats.totalJobs) }}</p>
              <p class="growth-rate">
                <mat-icon>trending_up</mat-icon> 
                {{ getGrowthPercentage(stats.totalJobs, stats.totalJobs - 50) }}% growth
              </p>
            </mat-card-content>
          </mat-card>

          <!-- Pending Jobs Card -->
          <mat-card class="performance-card">
            <mat-card-content>
              <div class="performance-icon-wrapper">
                <mat-icon class="card-icon">pending_actions</mat-icon>
              </div>
              <h4>Pending Jobs</h4>
              <p class="value">{{ stats.pendingJobs }}</p>
              <p class="growth-rate">
                <mat-icon>schedule</mat-icon> 
                Requires approval
              </p>
            </mat-card-content>
          </mat-card>

          <!-- Total Users Card -->
          <mat-card class="performance-card">
            <mat-card-content>
              <div class="performance-icon-wrapper">
                <mat-icon class="card-icon">people</mat-icon>
              </div>
              <h4>Total Users</h4>
              <p class="value">{{ formatNumber(stats.totalSeekers + stats.totalEmployers) }}</p>
              <p class="growth-rate">
                <mat-icon>trending_up</mat-icon> 
                {{ formatNumber(stats.totalSeekers) }} seekers, {{ formatNumber(stats.totalEmployers) }} employers
              </p>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <mat-divider></mat-divider>

      <!-- Users Management Section -->
      <div class="table-section">
        <h3 class="section-title">Users Management</h3>
        <mat-tab-group>
          <mat-tab class="usertype" label="Job Seekers ({{ stats.totalSeekers }})">
            <div *ngIf="isLoadingSeekers" class="loading-table">
              <mat-spinner diameter="30"></mat-spinner>
              <p>Loading job seekers...</p>
            </div>
            
            <div *ngIf="!isLoadingSeekers" class="table-container">
              <table mat-table [dataSource]="seekers" class="full-width-table mat-elevation-z2">
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Name</th>
                  <td mat-cell *matCellDef="let seeker">{{ seeker.name }}</td>
                </ng-container>
                
                <ng-container matColumnDef="email">
                  <th mat-header-cell *matHeaderCellDef>Email</th>
                  <td mat-cell *matCellDef="let seeker">{{ seeker.email }}</td>
                </ng-container>
                
                <ng-container matColumnDef="phoneNumber">
                  <th mat-header-cell *matHeaderCellDef>Phone</th>
                  <td mat-cell *matCellDef="let seeker">{{ seeker.phoneNumber || 'N/A' }}</td>
                </ng-container>
                
                <ng-container matColumnDef="address">
                  <th mat-header-cell *matHeaderCellDef>Address</th>
                  <td mat-cell *matCellDef="let seeker">{{ seeker.address || 'N/A' }}</td>
                </ng-container>
                
                <ng-container matColumnDef="skills">
                  <th mat-header-cell *matHeaderCellDef>Skills</th>
                  <td mat-cell *matCellDef="let seeker">
                    <span *ngIf="seeker.skillName?.length; else noSkills">
                      {{ seeker.skillName.slice(0, 2).join(', ') }}
                      <span *ngIf="seeker.skillName.length > 2">+{{ seeker.skillName.length - 2 }} more</span>
                    </span>
                    <ng-template #noSkills>N/A</ng-template>
                  </td>
                </ng-container>
                
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let seeker">
                    <button mat-icon-button color="primary" (click)="showSeekerDetails(seeker)" 
                            matTooltip="View Details">
                      <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteUser(seeker.userId)" 
                            matTooltip="Delete User">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>
                
                <tr mat-header-row *matHeaderRowDef="seekerColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: seekerColumns;"></tr>
              </table>
            </div>
          </mat-tab>

          <mat-tab label="Employers ({{ stats.totalEmployers }})">
            <div *ngIf="isLoadingEmployers" class="loading-table">
              <mat-spinner diameter="30"></mat-spinner>
              <p>Loading employers...</p>
            </div>
            
            <div *ngIf="!isLoadingEmployers" class="table-container">
              <table mat-table [dataSource]="employers" class="full-width-table mat-elevation-z2">
                
                
                <ng-container matColumnDef="email">
                  <th mat-header-cell *matHeaderCellDef>Email</th>
                  <td mat-cell *matCellDef="let employer">{{ employer.email }}</td>
                </ng-container>
                
                <ng-container matColumnDef="companyName">
                  <th mat-header-cell *matHeaderCellDef>Company</th>
                  <td mat-cell *matCellDef="let employer">{{ employer.companyName || 'N/A' }}</td>
                </ng-container>
                
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let employer">
                    <button mat-icon-button color="primary" (click)="showEmployerDetails(employer)" 
                            matTooltip="View Details">
                      <mat-icon>visibility</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteUser(employer.userId)" 
                            matTooltip="Delete User">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>
                
                <tr mat-header-row *matHeaderRowDef="employerColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: employerColumns;"></tr>
              </table>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>

      <mat-divider></mat-divider>

      <!-- Pending Jobs Section -->
      <div class="table-section">
        <h3 class="section-title">Pending Job Approvals ({{ stats.pendingJobs }})</h3>
        
        <div *ngIf="isLoadingJobs" class="loading-table">
          <mat-spinner diameter="30"></mat-spinner>
          <p>Loading pending jobs...</p>
        </div>
        
        <div *ngIf="!isLoadingJobs && pendingJobs.length === 0" class="no-data">
          <mat-icon>check_circle</mat-icon>
          <p>No pending jobs to approve!</p>
        </div>
        
        <div *ngIf="!isLoadingJobs && pendingJobs.length > 0" class="table-container">
          <table mat-table [dataSource]="pendingJobs" class="full-width-table mat-elevation-z2">
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Job Title</th>
              <td mat-cell *matCellDef="let job">{{ job.title }}</td>
            </ng-container>
            
            <ng-container matColumnDef="company">
              <th mat-header-cell *matHeaderCellDef>Company</th>
              <td mat-cell *matCellDef="let job">{{ job.companyName || 'N/A' }}</td>
            </ng-container>
                      
            <ng-container matColumnDef="salary">
              <th mat-header-cell *matHeaderCellDef>Salary</th>
              <td mat-cell *matCellDef="let job">{{ job.salary | currency:'EGP':'symbol':'1.0-0' }}</td>
            </ng-container>  
            
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let job">
                <button mat-icon-button color="accent" (click)="showJobDetails(job)" 
                        matTooltip="View Details">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="primary" (click)="approveJob(job.id)" 
                        matTooltip="Approve Job">
                  <mat-icon>check_circle</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="rejectJob(job.id)" 
                        matTooltip="Reject Job">
                  <mat-icon>cancel</mat-icon>
                </button>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="jobColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: jobColumns;"></tr>
          </table>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="secondary-sections">
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>User Distribution</mat-card-title>
          </mat-card-header>
          <mat-card-content class="chart-container">
            <canvas #userChart></canvas>
          </mat-card-content>
        </mat-card>
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>Job Status</mat-card-title>
          </mat-card-header>
          <mat-card-content class="chart-container">
            <canvas #jobStatusChart></canvas>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Details Modal -->
      <div *ngIf="showDetailsCard" class="details-card-overlay" (click)="closeDetails()">
        <mat-card class="details-card" (click)="$event.stopPropagation()">
          <mat-card-header>
            <mat-card-title ></mat-card-title>
            <button mat-icon-button class="close-button" (click)="closeDetails()">
              <mat-icon>close</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <!-- Loading Details -->
            <div *ngIf="isLoadingDetails" class="loading-container">
              <mat-spinner diameter="40"></mat-spinner>
              <p>Loading detailed information...</p>
            </div>

            <!-- Seeker Details -->
            <div *ngIf="detailsType === 'seeker' && selectedSeeker && !isLoadingDetails">
              <div class="profile-header">
                <img [src]="selectedSeeker.profileImageUrl || 'https://via.placeholder.com/150'" 
                     alt="Profile Image" class="profile-image">
                <div>
                  <h3>{{ selectedSeeker.name }}</h3>
                  <p class="profile-title">{{ selectedSeeker.title || 'Job Seeker' }}</p>
                </div>
              </div>
              <mat-divider></mat-divider>
              <div class="details-grid">
                <div class="details-row">
                  <span class="details-label">Email:</span>
                  <span class="details-value">{{ selectedSeeker.email }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Phone:</span>
                  <span class="details-value">{{ selectedSeeker.phoneNumber || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Address:</span>
                  <span class="details-value">{{ selectedSeeker.address || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Gender:</span>
                  <span class="details-value">{{ selectedSeeker.gender || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Date of Birth:</span>
                  <span class="details-value">{{ selectedSeeker.dateOfBirth || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Summary:</span>
                  <span class="details-value">{{ selectedSeeker.summary || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">CV:</span>
                  <a *ngIf="selectedSeeker.cV_Url" [href]="selectedSeeker.cV_Url" 
                     target="_blank" class="details-value cv-link">
                    <mat-icon>description</mat-icon> View CV
                  </a>
                  <span *ngIf="!selectedSeeker.cV_Url" class="details-value">N/A</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Skills:</span>
                  <div class="details-value">
                    <mat-chip-set  *ngIf="selectedSeeker.skillName?.length">
                      <mat-chip class="bla" *ngFor="let skill of selectedSeeker.skillName">{{ skill }} </mat-chip>
                    </mat-chip-set>
                    <span *ngIf="!selectedSeeker.skillName?.length">N/A</span>
                  </div>
                </div>
                <div class="details-row">
                  <span class="details-label">Certificates:</span>
                  <div class="details-value">
                    <mat-chip-set *ngIf="selectedSeeker.certificateName?.length">
                      <mat-chip class="bla" *ngFor="let cert of selectedSeeker.certificateName">{{ cert }}</mat-chip>
                    </mat-chip-set>
                    <span *ngIf="!selectedSeeker.certificateName?.length">N/A</span>
                  </div>
                </div>
                <div class="details-row">
                  <span class="details-label">Training:</span>
                  <div class="details-value">
                    <mat-chip-set *ngIf="selectedSeeker.trainingName?.length">
                      <mat-chip class="bla" *ngFor="let training of selectedSeeker.trainingName">{{ training }}</mat-chip>
                    </mat-chip-set>
                    <span *ngIf="!selectedSeeker.trainingName?.length">N/A</span>
                  </div>
                </div>
                <div class="details-row">
                  <span class="details-label">Interests:</span>
                  <div class="details-value">
                    <mat-chip-set *ngIf="selectedSeeker.interestName?.length">
                      <mat-chip class="bla" *ngFor="let interest of selectedSeeker.interestName">{{ interest }}</mat-chip>
                    </mat-chip-set>
                    <span *ngIf="!selectedSeeker.interestName?.length">N/A</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Employer Details -->
            <div *ngIf="detailsType === 'employer' && selectedEmployer && !isLoadingDetails">
              <div class="profile-header">
                <img [src]="selectedEmployer.companyImage || 'https://via.placeholder.com/150'" 
                     alt="Company Logo" class="profile-image">
                <div>
                  <h3>{{ selectedEmployer.companyName }}</h3>
                  <p class="profile-title">{{ selectedEmployer.companyName || 'Employer' }}</p>
                </div>
              </div>
              <mat-divider></mat-divider>
              <div class="details-grid">
                <div class="details-row">
                  <span class="details-label">Email:</span>
                  <span class="details-value">{{ selectedEmployer.email || 'N/A'}}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Phone:</span>
                  <span class="details-value">{{ selectedEmployer.phone || 'N/A'}}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Company Name:</span>
                  <span class="details-value">{{ selectedEmployer.companyName || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Website:</span>
                  <a *ngIf="selectedEmployer.website" [href]="selectedEmployer.website" 
                     target="_blank" class="details-value website-link">
                    <mat-icon>language</mat-icon> Visit Website
                  </a>
                  <span *ngIf="!selectedEmployer.website" class="details-value">N/A</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Location:</span>
                  <span class="details-value">{{ selectedEmployer.companyLocation || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Industry:</span>
                  <span class="details-value">{{ selectedEmployer.industry || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Company Size:</span>
                  <span class="details-value">{{ selectedEmployer.employeeRange || 'N/A' }}</span>
                </div>
                <div class="details-row full-width">
                  <span class="details-label">Description:</span>
                  <span class="details-value">{{ selectedEmployer.companyDescription || 'N/A' }}</span>
                </div>
              </div>
            </div>

            <!-- Job Details -->
            <div *ngIf="detailsType === 'job' && selectedJob && !isLoadingDetails">
              <div class="profile-header">
                <img [src]="selectedJob.companyImage" 
                     alt="Company Logo" class="profile-image">
                <div>
                  <h3>{{ selectedJob.title }}</h3>
                  <p class="profile-title">{{ selectedJob.companyName }}</p>
                </div>
              </div>
              <mat-divider></mat-divider>
              <div class="details-grid">
                <div class="details-row">
                  <span class="details-label">Title:</span>
                  <span class="details-value">{{ selectedJob.title }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Location:</span>
                  <span class="details-value">{{ selectedJob.location }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Salary:</span>
                  <span class="details-value">{{ selectedJob.salary | currency:'EGP':'symbol':'1.0-0' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Employment Type:</span>
                  <span class="details-value">{{ selectedJob.jobType }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Posted Date:</span>
                  <span class="details-value">{{ selectedJob.postedDate | date:'dd/MM/yyyy' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Status:</span>
                  <span class="details-value">
                    <mat-chip class="bla" [style.background-color]="selectedJob.isApproved ? '#a5b3f1' : '#bfabd3'">
                      {{ selectedJob.isApproved ? 'Approved' : 'Pending' }}
                    </mat-chip>
                  </span>
                </div>
                <div class="details-row">
                  <span class="details-label">Employer Email:</span>
                  <span class="details-value">{{ selectedJob.email || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Employer Phone:</span>
                  <span class="details-value">{{ selectedJob.phone || 'N/A' }}</span>
                </div>
                <div class="details-row">
                  <span class="details-label">Company Website:</span>
                  <a *ngIf="selectedJob?.website" [href]="selectedJob.website" 
                     target="_blank" class="details-value website-link">
                    <mat-icon>language</mat-icon> Visit Website
                  </a>
                  <span *ngIf="!selectedJob?.website" class="details-value">N/A</span>
                </div>
                <div class="details-row full-width">
                  <span class="details-label">Description:</span>
                  <span class="details-value">{{ selectedJob.description }}</span>
                </div>
                <div class="details-row full-width">
                  <span class="details-label">Requirements:</span>
                  <span class="details-value">{{ selectedJob.requirements }}</span>
                </div>
              </div>
              
              <!-- Action buttons for job approval -->
              <div class="details-actions" style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #f0f0f0;">
                <button mat-raised-button color="primary" (click)="approveJob(selectedJob.id); closeDetails()">
                  <mat-icon>check_circle</mat-icon>
                  Approve Job
                </button>
                <button mat-raised-button color="warn" (click)="rejectJob(selectedJob.id); closeDetails()">
                  <mat-icon>cancel</mat-icon>
                  Reject Job
                </button>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </mat-card-content>
</mat-card>