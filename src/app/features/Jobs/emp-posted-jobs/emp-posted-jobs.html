<body>
  <div class="nav fade-block">
    <a routerLink="/empDashboard"><i class="bi bi-arrow-left me-3 fs-3"></i></a>
    <h5 class="mt-2 fade-line">Back to Dashboard</h5>
  </div>

  <div class="container my-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center page-header fade-block">
      <div>
        <h2 class="fw-bold fade-line">My Jobs</h2>
        <p class="text-muted fade-line">Manage and track your job postings</p>
      </div>
      <div>
        <button class="btn btn-primary fade-line" routerLink="/addJob">+ Post New Job</button>
      </div>
    </div>

    <!-- Metrics -->
    <div class="row g-3 mb-4 fade-block">
      <div class="col-md-4 fade-line">
        <div class="metrics-card">
          <div class="d-flex justify-content-between">
            <h5>Total Active Jobs</h5>
            <i class="bi bi-suitcase-lg text-primary"></i>
          </div>
          <div class="metrics-number">{{ expiringSoonJobs()?.totalActiveJobs }}</div>
        </div>
      </div>
      <div class="col-md-4 fade-line">
        <div class="metrics-card">
          <div class="d-flex justify-content-between">
            <h5>Applications This Month</h5>
            <i class="bi bi-people text-primary"></i>
          </div>
          <div class="metrics-number">{{ expiringSoonJobs()?.applicationsThisMonth }}</div>
        </div>
      </div>
      <div class="col-md-4 fade-line">
        <div class="metrics-card">
          <div class="d-flex justify-content-between">
            <h5>Jobs Expiring Soon</h5>
            <i class="bi bi-clock-history text-primary"></i>
          </div>
          <div class="metrics-number">{{ expiringSoonJobs()?.jobsExpiringSoon }}</div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="search-filters mb-4 fade-block">
      <div class="row g-3 align-items-center fade-line">
        <div class="col-7 mx-auto">
          <input 
            type="text" 
            class="form-control fade-line"
            placeholder="Search jobs by title or keyword..."
            [value]="searchValue()"
            (input)="onSearchChange($event)">
        </div>

        <div class="d-flex justify-content-around mt-3 fade-line">
          <div class="col-md-4">
            <strong>Status</strong>
            <select 
              class="form-select mt-2"
              [value]="selectedStatus()"
              (change)="onStatusChange($event)">
              <option>All Status</option>
              <option value="Active">Active</option>
              <option value="Expired">Expired</option>
              <option value="Filled">Filled</option>
            </select>
          </div>

          <div class="col-md-4">
            <strong>Sort by</strong>
            <select 
              class="form-select mt-2"
              [value]="selectedSort()"
              (change)="onSortChange($event)">
              <option value="PostedDateDesc">Newest First</option>
              <option value="PostedDateAsc">Oldest First</option>
              <option value="ApplicationsCountDesc">Most Applications</option>
            </select>
          </div>
        </div>

        <div class="col-12 text-center mt-3 fade-line">
          <button class="btn btn-outline-secondary" (click)="clearFilters()">
            <i class="bi bi-x-circle me-2"></i>Clear Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading()"><app-loading-page></app-loading-page></div>

    <!-- No Results -->
    <div class="text-center my-5 fade-block" *ngIf="!isLoading() && postedJobs().length === 0">
      <i class="bi bi-inbox display-4 text-muted fade-line"></i>
      <h4 class="mt-3 text-muted fade-line">No jobs found</h4>
      <p class="text-muted fade-line">Try adjusting your search criteria or post a new job.</p>
    </div>

    <!-- Job Cards -->
    <div class="row g-3 fade-block" *ngIf="!isLoading() && postedJobs().length > 0">
      <div class="col-md-6 col-lg-4 fade-block" *ngFor="let job of postedJobs()">
        <div class="job-card fade-block">
          <div class="d-flex justify-content-between align-items-start fade-line">
            <h5 class="fw-bold mt-2">{{ job.title }}</h5>
            <button class="delete" (click)="deleteJob(job.id, job.title)" [disabled]="isLoading()">
              <i class="bi bi-trash3"></i>
            </button>
          </div>

          <span class="job-status fade-line"
            [ngClass]="{
              'status-active': job.status === 'Active',
              'status-filled': job.status === 'Filled',
              'status-expired': job.status === 'Expired'
            }">{{ job.status }}</span>

          <p class="text-muted small mt-3 fade-line">
            <i class="bi bi-calendar me-1"></i>Posted: {{ job.postedDateFormatted }} â€¢ 
            <i class="bi bi-clock-history ms-1"></i>Expires: {{ job.expireDateFormatted }}
          </p>
          <p class="small text-muted fade-line">
            <i class="bi bi-people me-1"></i>{{ job.applicationsCount }} applications
          </p>

          <div class="mt-4 d-flex justify-content-center fade-line">
            <button class="btn btn-outline-secondary px-5 me-3" [routerLink]="['/editJob', job.id]">
              <i class="bi bi-pencil-square me-2"></i>Edit
            </button> 
            <button class="btn btn-primary px-5" [routerLink]="['/appViewJob', job.id]"> 
              <i class="bi bi-people me-2"></i> View Apps
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
