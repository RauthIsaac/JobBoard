<div class="nav">
    <a routerLink="/empDashboard"><i class="bi bi-arrow-left me-3 fs-3"></i> </a>
    <h5 class="mt-2">Back to Dashboard</h5>
</div>

<mat-card class="seeker-profile-card">
    <mat-card-header>
        <mat-card-title class="text-center">
            <h2 class="mat-headline">Edit Employer Profile</h2>
        </mat-card-title>
    </mat-card-header>    

    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        <mat-card-content class="space-y-6">
            <!-- Company Logo Upload Section -->
            <div class="info-section text-center">
                <div class="profile-avatar mx-auto" (click)="triggerFileInput()" 
                     style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; cursor: pointer; position: relative; border: 3px solid #ddd;">
                    
                    <img [src]="imagePreview" 
                         alt="Company Logo" 
                         (error)="onImageError($event)"
                         style="width: 100%; height: 100%; object-fit: cover;">
                    
                    <div class="upload-overlay" 
                         style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); 
                                display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;"
                         onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
                        <mat-icon style="color: white; font-size: 2rem;">camera_alt</mat-icon>
                    </div>
                </div>
                
                <input #fileInput 
                       type="file" 
                       accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" 
                       (change)="onImageSelected($event)" 
                       style="display: none;">
                
                <div class="text-center mt-3">
                    <p class="text-sm text-gray-600 mb-2">
                        <span *ngIf="!hasCustomImage()">Click to upload company logo</span>
                        <span *ngIf="hasCustomImage()">Click to change company logo</span>
                    </p>
                    
                    <button mat-button 
                            color="warn" 
                            type="button"
                            *ngIf="hasCustomImage() && !shouldRemoveImage"
                            (click)="removeImage()">
                        <mat-icon>delete</mat-icon> Remove Logo
                    </button>
                    
                    <button mat-button 
                            color="primary" 
                            type="button"
                            *ngIf="shouldRemoveImage"
                            (click)="triggerFileInput()">
                        <mat-icon>cloud_upload</mat-icon> Upload New Logo
                    </button>
                </div>
            </div>

            <!-- Form Fields -->
            <div class="info-section">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Company Name -->
                    <mat-form-field appearance="outline">
                        <mat-label>Company Name</mat-label>
                        <input matInput formControlName="companyName" placeholder="Company Name" />
                        <mat-error *ngIf="f['companyName'].hasError('required')">
                            Company name is required
                        </mat-error>
                        <mat-error *ngIf="f['companyName'].hasError('maxlength')">
                            Maximum 100 characters allowed
                        </mat-error>
                    </mat-form-field>

                    <!-- Company Location -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Company Location</mat-label>
                        <input matInput formControlName="companyLocation" placeholder="Company Location" />
                        <mat-error *ngIf="f['companyLocation'].hasError('required')">
                            Location is required
                        </mat-error>
                    </mat-form-field>

                    <!-- Industry -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Industry</mat-label>
                        <input matInput formControlName="industry" placeholder="Industry" />
                        <mat-error *ngIf="f['industry'].hasError('required')">
                            Industry is required
                        </mat-error>
                    </mat-form-field>

                    <!-- Employee Range -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Company Range Size</mat-label>
                        <input matInput formControlName="employeeRange" placeholder="Company Range Size" />
                        <mat-error *ngIf="f['employeeRange'].hasError('required')">
                            Employee range is required
                        </mat-error>
                    </mat-form-field>

                    <!-- Website -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Company Website</mat-label>
                        <input matInput formControlName="website" placeholder="Company Website" />
                        <mat-error *ngIf="f['website'].hasError('pattern')">
                            Please enter a valid URL (http:// or https://)
                        </mat-error>
                    </mat-form-field>

                    <!-- Email -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Company Email</mat-label>
                        <input matInput formControlName="email" placeholder="Company Email" />
                        <mat-error *ngIf="f['email'].hasError('required')">
                            Email is required
                        </mat-error>
                        <mat-error *ngIf="f['email'].hasError('email')">
                            Please enter a valid email
                        </mat-error>
                    </mat-form-field>

                    <!-- Phone -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Company Phone</mat-label>
                        <input matInput formControlName="phone" placeholder="Company Phone" />
                        <mat-error *ngIf="f['phone'].hasError('pattern')">
                            Please enter a valid phone number
                        </mat-error>
                    </mat-form-field>

                    <!-- Founded At -->
                    <mat-form-field appearance="outline" class="w-full">
                        <mat-label>Founded At</mat-label>
                        <input matInput type="number" formControlName="establishedYear" 
                               placeholder="Enter year (e.g. 1999)" 
                               min="1900" [max]="currentYear" step="1" />
                        <mat-error *ngIf="f['establishedYear'].hasError('required')">
                            Year is required
                        </mat-error>
                        <mat-error *ngIf="f['establishedYear'].hasError('min') || f['establishedYear'].hasError('max')">
                            Year must be between 1900 and {{currentYear}}
                        </mat-error>
                        <mat-error *ngIf="f['establishedYear'].hasError('pattern')">
                            Please enter a valid 4-digit year
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <!-- Company Mission -->
            <mat-form-field appearance="outline" class="w-full mt-4">
                <mat-label>Company Mission</mat-label>
                <textarea matInput formControlName="companyMission" 
                          placeholder="Company Mission" 
                          matTextareaAutosize matAutosizeMinRows="1" 
                          matAutosizeMaxRows="10"></textarea>
                <mat-error *ngIf="f['companyMission'].hasError('maxlength')">
                    Maximum 500 characters allowed
                </mat-error>
            </mat-form-field>

            <!-- Company Description -->
            <mat-form-field appearance="outline" class="w-full">
                <mat-label>Company Description</mat-label>
                <textarea matInput formControlName="companyDescription" 
                          placeholder="Company Description" 
                          matTextareaAutosize matAutosizeMinRows="3" 
                          matAutosizeMaxRows="6"></textarea>
                <mat-error *ngIf="f['companyDescription'].hasError('required')">
                    Description is required
                </mat-error>
                <mat-error *ngIf="f['companyDescription'].hasError('maxlength')">
                    Maximum 2000 characters allowed
                </mat-error>
            </mat-form-field>
        </mat-card-content>

        <mat-card-actions class="flex justify-center mt-6">
            <button mat-raised-button 
                    color="primary" 
                    class="w-full md:w-auto" 
                    type="submit"
                    [disabled]="isLoading">
                <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
                <mat-icon *ngIf="!isLoading">save</mat-icon> 
                {{ isLoading ? 'Saving...' : 'Save Edits' }}
            </button>
        </mat-card-actions>
    </form>
</mat-card>